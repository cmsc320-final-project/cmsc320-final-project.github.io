<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Analyzing Goodreads’ Readership</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="/">← Back to Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Analyzing Goodreads’ Readership</h1>

</div>


<p>Goodreads is a social cataloging site where users can search, track, and rate books. The site has over 20 million users, making it a large source of readership data. In this project, we demonstrate how one can leverage this data using the Goodbooks-10k dataset <span class="citation">(Zajac 2017)</span> to do analysis on Goodread’s readership by genre.</p>
<div id="loading-and-pre-processing-data" class="section level2">
<h2>Loading and Pre-processing Data</h2>
<p>After being obtained, the data can be easily loaded using R’s <code>read.csv</code> method. For example, here we can load and display <code>books.csv</code> to get a broad picture of one of the datasets we will be working with. We can see that <code>books.csv</code> organizes its data in a tabulated manner with each book as a row and the attributes of a book as columns.</p>
<pre class="r"><code>books_df &lt;- read.csv(&quot;./goodbooks-10k/books.csv&quot;) %&gt;%
  as_tibble()
head(books_df)</code></pre>
<pre><code>## # A tibble: 6 x 23
##   book_id goodreads_book_~ best_book_id work_id books_count isbn   isbn13
##     &lt;int&gt;            &lt;int&gt;        &lt;int&gt;   &lt;int&gt;       &lt;int&gt; &lt;fct&gt;   &lt;dbl&gt;
## 1       1          2767052      2767052  2.79e6         272 4390~ 9.78e12
## 2       2                3            3  4.64e6         491 4395~ 9.78e12
## 3       3            41865        41865  3.21e6         226 3160~ 9.78e12
## 4       4             2657         2657  3.28e6         487 6112~ 9.78e12
## 5       5             4671         4671  2.45e5        1356 7432~ 9.78e12
## 6       6         11870085     11870085  1.68e7         226 5254~ 9.78e12
## # ... with 16 more variables: authors &lt;fct&gt;, original_publication_year &lt;dbl&gt;,
## #   original_title &lt;fct&gt;, title &lt;fct&gt;, language_code &lt;fct&gt;,
## #   average_rating &lt;dbl&gt;, ratings_count &lt;int&gt;, work_ratings_count &lt;int&gt;,
## #   work_text_reviews_count &lt;int&gt;, ratings_1 &lt;int&gt;, ratings_2 &lt;int&gt;,
## #   ratings_3 &lt;int&gt;, ratings_4 &lt;int&gt;, ratings_5 &lt;int&gt;, image_url &lt;fct&gt;,
## #   small_image_url &lt;fct&gt;</code></pre>
<p>Let’s load the rest of our data as well.</p>
<pre class="r"><code>ratings_df &lt;- read.csv(&quot;./goodbooks-10k/ratings.csv&quot;)%&gt;%
  as_tibble()
tags_df &lt;- read.csv(&quot;./goodbooks-10k/tags.csv&quot;)%&gt;%
  as_tibble()
book_tags_df &lt;- read.csv(&quot;./goodbooks-10k/book_tags.csv&quot;)%&gt;%
  as_tibble()</code></pre>
<p>One of the things we are interested in is the genre of certain books. We can narrow down the genres we are interested in with pipeline that filters for certain genre names.</p>
<pre class="r"><code>tags_df &lt;- tags_df %&gt;%
  filter(tag_name %in% c(
    &quot;fantasy&quot;,
    &quot;mystery&quot;,
    &quot;horror&quot;,
    &quot;realistic-fiction&quot;,
    &quot;romance&quot;,
    &quot;science-fiction&quot;,
    &quot;thriller&quot;,
    &quot;young-adult&quot;
  )) %&gt;%
  as_tibble()

tags_df</code></pre>
<pre><code>## # A tibble: 8 x 2
##   tag_id tag_name         
##    &lt;int&gt; &lt;fct&gt;            
## 1  11305 fantasy          
## 2  14821 horror           
## 3  20939 mystery          
## 4  25438 realistic-fiction
## 5  26138 romance          
## 6  26837 science-fiction  
## 7  30358 thriller         
## 8  33114 young-adult</code></pre>
<p>However, this information is not very helpful by itself. We want to be able to use it in conjunction with the other data we have. One way to accomplish this is by joining data across different datasets through a common attribute. Here, we construct a pipeline to link data from <code>books_df</code> and <code>book_tags_df</code> through the shared attribute, <code>goodreads_book_id</code>, and then <code>book_tags_df</code> and <code>tags_df</code> through <code>tag_id</code>. We can see that <code>tag_name</code> does indeed describe the genre of the books it’s associated with.</p>
<pre class="r"><code>book_genres_df &lt;- books_df %&gt;%
  inner_join(book_tags_df, by=&quot;goodreads_book_id&quot;) %&gt;%
  inner_join(tags_df, by=&quot;tag_id&quot;) %&gt;%
  select(&quot;book_id&quot;, &quot;title&quot;, &quot;tag_name&quot;)

book_genres_df %&gt;%
  select(&quot;title&quot;, &quot;tag_name&quot;) %&gt;%
  head(15)</code></pre>
<pre><code>## # A tibble: 15 x 2
##    title                                                    tag_name         
##    &lt;fct&gt;                                                    &lt;fct&gt;            
##  1 The Hunger Games (The Hunger Games, #1)                  young-adult      
##  2 The Hunger Games (The Hunger Games, #1)                  fantasy          
##  3 The Hunger Games (The Hunger Games, #1)                  science-fiction  
##  4 The Hunger Games (The Hunger Games, #1)                  romance          
##  5 The Hunger Games (The Hunger Games, #1)                  thriller         
##  6 Harry Potter and the Sorcerer&#39;s Stone (Harry Potter, #1) fantasy          
##  7 Harry Potter and the Sorcerer&#39;s Stone (Harry Potter, #1) young-adult      
##  8 Harry Potter and the Sorcerer&#39;s Stone (Harry Potter, #1) mystery          
##  9 Twilight (Twilight, #1)                                  young-adult      
## 10 Twilight (Twilight, #1)                                  fantasy          
## 11 Twilight (Twilight, #1)                                  horror           
## 12 Twilight (Twilight, #1)                                  science-fiction  
## 13 To Kill a Mockingbird                                    young-adult      
## 14 To Kill a Mockingbird                                    realistic-fiction
## 15 To Kill a Mockingbird                                    mystery</code></pre>
<p>Now we can use <code>book_genres_df</code> to try to figure out Goodreads readership. Let’s build another pipeline to join with <code>ratings_df</code> to link users with the genres of the books they rated. We can do more data manipulation from there to end up with a table of mean ratings in each genre of interest for each users. The ratings range from 1 to 5. We also choose to designate a mean rating of -5 to genres with no rating.</p>
<pre class="r"><code># TODO: What should we replace na with??

# Note: This takes awhile to run...

user_features_raw_df &lt;- ratings_df %&gt;%
  inner_join(book_genres_df, by=&quot;book_id&quot;) %&gt;%
  spread(tag_name, rating) %&gt;%
  select(-book_id, -title,)

user_features_df &lt;- user_features_raw_df %&gt;%
  group_by(user_id) %&gt;%
  summarize_all(mean, na.rm=TRUE) %&gt;%
  select(-user_id,) %&gt;%
  mutate_if(~ any(is.na(.x)),~ if_else(is.na(.x),-5,.x)) # Replace na with -5

# Convert column names to snake_case
colnames(user_features_df) = to_snake_case(colnames(user_features_df))

head(user_features_df, 15)</code></pre>
<pre><code>## # A tibble: 15 x 8
##    fantasy horror mystery realistic_ficti~ romance science_fiction thriller
##      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;    &lt;dbl&gt;
##  1    3.55   3.29    3.4              3.51    3.45            3.14     3.4 
##  2    4.85   5       4.9              4.38    4.12            4.75     4.67
##  3    1.45   1.5     1.24             2       1.76            1.17     1.13
##  4    3.90   3.59    3.55             3.65    3.44            3.54     3.18
##  5    4.11   4.03    4.03             3.95    3.93            4.11     4   
##  6    4.2    4.25    4.14             4.29    4.43            4.17     4.25
##  7    3.79   3.78    3.76             4       3.51            3.76     3.6 
##  8    4.09   3.95    3.81             3.25    3.17            4.42     3.4 
##  9    3.66   3.67    3.25             3.37    3.52            3.58     3.03
## 10    4.02   3.88    3.92             3.86    3.76            3.89     3.96
## 11    3.63   3.69    3.42             3.59    3.44            3.4      3.69
## 12    3.54   3.38    3.85             3.86    3.56            3.81     3.93
## 13    3.64   4       4.33             4.29    4.11            4        4.4 
## 14    3.61   3.6     3.6              3.08    3.32            3.66     3.31
## 15    4.26   4.45    4                4.35    4.31            4.33     4.08
## # ... with 1 more variable: young_adult &lt;dbl&gt;</code></pre>
</div>
<div id="data-visualization-and-analysis" class="section level2">
<h2>Data Visualization and Analysis</h2>
<p>One way we can better understand our data is through visualization. For example, if we want to see where the readership lies on average ratings for young adult and fantasy by plotting a 2D scatterplot. From the graph, it appears most users are clustered from 3 to 5, and there is not a strong overall preference for one genre versus the other. There are also several users that appear to be readers of one genre but not the other, and at least one user that does not read from either.</p>
<pre class="r"><code>ggplot(user_features_df, mapping=aes(x=fantasy, y=young_adult)) +
  geom_point() +
  labs(
    title=&quot;User Average Ratings for Young Adult Versus Fantasy&quot;,
    x=&quot;Fantasy Rating&quot;,
    y=&quot;Young Adult Ratings&quot;
  )</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>While the graph above is fine for comparing two genres, for comparing many genres it becomes infeasible as it is hard visualize space beyond 3 dimensions. Furthermore, we are also interested in clustering our data. While we had done a very cursory grouping by eye-balling above, ideally, there should be a way to more formally say which data points form a group with one another.</p>
<p>The solution to both of these problems is using a combination of K-means clustering to determine groups of similar readers and principle component analysis (PCA) to reduce the dimensions of our feature vectors for visualization in 2D space.</p>
<div id="determining-k" class="section level3">
<h3>Determining K</h3>
<p>The main issue with using K-means is that we do not have a good idea of what is a “good” K. One way we can address this is by doing several test runs with different K’s and comparing them, specifically, by comparing their total sum of squared distances (SSE). Intuitively, a good clustering should minimize the distances of points to the centroids of their respective clusters which would be reflected in a low total SSE <span class="citation">(Dabbura 2018)</span>.</p>
<p>While we want to lower variation within clusters, at the same time, we also want our clusters to actually be clusters. This means that for any data point, it should ideally be close to the centroid of its cluster and far from others, a metric known as the silhouette <span class="citation">(Boehmke, n.d.)</span>. While increasing K to an unreasonably large number may reduce total SSE, data in such a clustering would have low silhouettes since data points in one cluster would be very close to data points in other clusters.</p>
<p>The goal of finding a good K then resides in reducing SSE while still trying to keep silhouette high. Let’s compute and graph both SSE and silhouette from a sample of the users to see what a good K might be.</p>
<pre class="r"><code>set.seed(320)

k_range &lt;- 2:20
user_features_sample_df &lt;- sample_n(user_features_df, 1000)

# SSE
sse &lt;- sapply(k_range, function(k) {
  kmeans(user_features_sample_df, k)$tot.withinss
})

ggplot(mapping=aes(x=k_range, y=sse)) +
  geom_line() +
  geom_label(aes(label=k_range)) + 
  labs(
    title=&quot;Total SSE vs K&quot;,
    x=&quot;k&quot;,
    y=&quot;Total SSE&quot;
  )</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Average silhouettes
sil &lt;- sapply(k_range, function(k) {
  km.res &lt;- kmeans(user_features_sample_df, centers=k)
  ss &lt;- silhouette(km.res$cluster, dist(user_features_sample_df))
  mean(ss[,3])
})

ggplot(mapping=aes(x=k_range, y=sil)) +
  geom_line() +
  geom_label(aes(label=k_range)) + 
  labs(
    title=&quot;Average Silhouettes vs K&quot;,
    x=&quot;k&quot;,
    y=&quot;Average Silhouette&quot;
  )</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-7-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>Observing both graphs, K = 6 appears to be a point where total SSE has begun to flatten but average silhouette is still somewhat high, making it a reasonable compromise for K. Let’s try to cluster all of our users with this K.</p>
<pre class="r"><code>set.seed(320)

kmeans_res &lt;- kmeans(user_features_df, 6)
kmeans_res$centers</code></pre>
<pre><code>##    fantasy    horror  mystery realistic_fiction  romance science_fiction
## 1 4.082210  4.058811 4.089536         -5.000000 4.032686        3.992722
## 2 4.069565  3.952256 4.034179          3.963205 3.984413        4.037278
## 3 3.535047 -5.000000 3.991061          3.883914 3.959537        1.899152
## 4 4.574821  4.527793 4.562151          4.475765 4.517483        4.562859
## 5 3.617038  3.454431 3.579493          3.538471 3.536758        3.567962
## 6 3.113330  2.955288 3.112006          3.132536 3.098398        2.590623
##   thriller young_adult
## 1 3.995147    4.029354
## 2 3.992261    4.067606
## 3 3.133296    4.092793
## 4 4.551805    4.556903
## 5 3.527587    3.626548
## 6 2.693218    3.149608</code></pre>
<pre class="r"><code>autoplot(kmeans_res, data=user_features_df, frame=TRUE) +
  labs(title=&quot;Readership Clusters&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>TODO: talk about clusters</strong> <strong>TODO: Research and talk about pca</strong></p>
</div>
</div>
<div id="predictions" class="section level2">
<h2>Predictions</h2>
<pre class="r"><code># TODO: cluster prediction (logistic regression? decision tree?)

training_data &lt;- user_features_df %&gt;%
  mutate(cluster=kmeans_res$cluster)

head(training_data, 15)</code></pre>
<pre><code>## # A tibble: 15 x 9
##    fantasy horror mystery realistic_ficti~ romance science_fiction thriller
##      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;    &lt;dbl&gt;
##  1    3.55   3.29    3.4              3.51    3.45            3.14     3.4 
##  2    4.85   5       4.9              4.38    4.12            4.75     4.67
##  3    1.45   1.5     1.24             2       1.76            1.17     1.13
##  4    3.90   3.59    3.55             3.65    3.44            3.54     3.18
##  5    4.11   4.03    4.03             3.95    3.93            4.11     4   
##  6    4.2    4.25    4.14             4.29    4.43            4.17     4.25
##  7    3.79   3.78    3.76             4       3.51            3.76     3.6 
##  8    4.09   3.95    3.81             3.25    3.17            4.42     3.4 
##  9    3.66   3.67    3.25             3.37    3.52            3.58     3.03
## 10    4.02   3.88    3.92             3.86    3.76            3.89     3.96
## 11    3.63   3.69    3.42             3.59    3.44            3.4      3.69
## 12    3.54   3.38    3.85             3.86    3.56            3.81     3.93
## 13    3.64   4       4.33             4.29    4.11            4        4.4 
## 14    3.61   3.6     3.6              3.08    3.32            3.66     3.31
## 15    4.26   4.45    4                4.35    4.31            4.33     4.08
## # ... with 2 more variables: young_adult &lt;dbl&gt;, cluster &lt;int&gt;</code></pre>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p><strong>TODO: Write conclusion</strong></p>
<div id="refs" class="references">
<div id="ref-kmeansUCR">
<p>Boehmke, Bradley. n.d. “K-Means Cluster Analysis.” <em>UC Business Analytics R Programming Guide</em>.</p>
</div>
<div id="ref-kmeansTDS">
<p>Dabbura, Imad. 2018. “Applications, Evaluation Methods, and Drawbacks.” <em>Towards Data Science</em>.</p>
</div>
<div id="ref-goodbooks2017">
<p>Zajac, Zygmunt. 2017. “Goodbooks-10k: A New Dataset for Book Recommendations.” <em>FastML</em>.</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
